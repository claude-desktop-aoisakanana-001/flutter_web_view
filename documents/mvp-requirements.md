# MVP要件定義書

**プロジェクト名**: 小説家になろうリーダーアプリ
**バージョン**: 1.0.0
**最終更新**: 2025-11-30
**ステータス**: 承認済み

---

## 1. プロジェクト概要

### 1.1 目的
「小説家になろう」の閲覧体験を拡張し、自動読み上げ機能を提供するモバイルアプリを開発する。

### 1.2 ビジョン
将来的には「小説家になろう」公式パートナーとなることを視野に入れる。

### 1.3 対象プラットフォーム
- **初期リリース**: iOS
- **将来展開**: Android（Flutterのマルチプラットフォーム対応を活用）

---

## 2. MVP必須機能

### 2.1 小説閲覧機能
- 「小説家になろう」の小説ページを表示
- HTTPクライアントで直接URLからHTMLを取得（WebView Option B）
- HTML解析により本文を抽出

### 2.2 読み上げ機能
- 抽出した小説本文をテキスト読み上げ（TTS）
- 基本的な自然言語処理ライブラリの挙動に基づいた読み上げ
- 読み上げ中の文章をハイライト表示
- 読み上げ位置に合わせた自動スクロール

### 2.3 読み上げ速度設定
- ユーザーが読み上げ速度を調整可能
- 将来的な拡張性を担保：
  - 行ごとの間隔設定
  - 段落ごとの間隔設定
  - その他の音声パラメータ設定

### 2.4 再生コントローラー
- 再生ボタン
- 一時停止ボタン
- 停止ボタン
- 現在の再生状態の表示

---

## 3. 非機能要件

### 3.1 パフォーマンス
- アプリ起動から小説表示まで3秒以内
- 読み上げ開始までのレスポンスタイム1秒以内
- スムーズな自動スクロール（フレームドロップなし）

### 3.2 ユーザビリティ
- 直感的な操作UI
- シンプルで分かりやすいコントローラー配置
- 読み上げ位置が視覚的に明確

### 3.3 信頼性
- ネットワークエラー時の適切なエラーハンドリング
- HTML構造変更への耐性（エラー時の適切なフォールバック）

---

## 4. 技術的制約

### 4.1 対象サイト
- 「小説家になろう」専用アプリとして開発
- 他社小説サイトへの拡張は意図しない
- 過度な抽象化は避ける

### 4.2 設計方針
- シンプルな設計を優先
- 自然な設計の結果として得られる拡張性は許容
- 「小説家になろう」に最適化された実装

---

## 5. MVP範囲外（将来機能）

以下の機能はMVPには含まず、将来的な拡張として検討：

- しおり機能
- お気に入り登録
- 読書履歴
- オフライン読書
- バックグラウンド再生
- 音声の詳細設定（音量、ピッチなど）
- ユーザーアカウント連携
- マルチデバイス同期

---

## 6. 成功基準

### 6.1 機能的成功基準
- [ ] 小説本文を正しく抽出できる
- [ ] TTSで本文を読み上げられる
- [ ] 読み上げ速度を変更できる
- [ ] 再生/一時停止/停止が正常に動作する
- [ ] 読み上げ位置がハイライトされる
- [ ] 自動スクロールが動作する

### 6.2 技術的成功基準
- [ ] すべてのテストが成功
- [ ] flutter analyze でエラーなし
- [ ] iOS実機でビルド・実行可能
- [ ] クラッシュなく30分以上連続稼働

---

## 7. HTML解析要件

### 7.1 解析対象
- 「小説家になろう」の小説ページHTML
- 本文部分の特定とテキスト抽出
- ルビ（振り仮名）の適切な処理
- 章タイトル、区切りの検出

### 7.2 調査事項（Issue化）
- 本文が格納されているHTML要素のセレクタ特定
- ルビの扱い方（読み上げ時の処理）
- 章の区切りの検出方法
- 特殊記法（傍点、改行など）の処理方法

---

## 8. TTS要件詳細

### 8.1 基本動作
- flutter_tts を使用
- デフォルトは日本語音声
- 文章単位で読み上げ

### 8.2 拡張性の担保
TTSConfigモデルで以下の設定を将来的にサポートできるように設計：

```dart
class TTSConfig {
  final double speed;              // 読み上げ速度（MVP対応）
  final double pitch;              // 音程（将来対応）
  final double volume;             // 音量（将来対応）
  final double linePause;          // 行間の間隔（将来対応）
  final double paragraphPause;     // 段落間の間隔（将来対応）
}
```

### 8.3 ハイライト表示
- 現在読み上げ中の文章を視覚的にハイライト
- 背景色変更またはテキスト色変更
- アニメーション不要（シンプルに）

### 8.4 自動スクロール
- 読み上げ位置が画面外に出る前にスクロール
- スムーズなスクロール動作
- ユーザーが手動スクロールした場合は自動スクロールを一時停止

---

## 9. データフロー（確定版）

```
小説URL
    ↓
HTTP GET（httpパッケージ）
    ↓
HTML取得
    ↓
HTML解析（htmlパッケージ）
    ↓
本文テキスト抽出
    ↓
NovelContentモデル
    ↓
TTSService（flutter_tts）
    ↓
読み上げ + ハイライト + 自動スクロール
    ↓
PlaybackController（UI制御）
```

---

## 10. 開発制約

### 10.1 Git運用
- git push 禁止
- ブランチ戦略は別途指示に従う

### 10.2 実装前の合意
- コードを書く前に設計を議論
- 決定事項は `documents/` 配下にmarkdownで保存

### 10.3 プログラム実行
- 実行前に許可を得る
- テスト実行も含む

---

## 11. 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-11-30 | 1.0.0 | 初版作成。WebView Option B採用、ハイライト・自動スクロール追加 |

---

## 12. 承認

- **作成者**: Claude (AI Assistant)
- **レビュー**: ユーザー承認済み
- **承認日**: 2025-11-30
